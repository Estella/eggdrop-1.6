$Id: UPDATES1.6,v 1.181 2001/09/23 20:17:46 guppy Exp $

Changes in eggdrop: (since v1.6.0)
----------------------------------

1.6.7
Found by  Fixed by  What...
various   stdarg    proper utf8 support
          TaKeDa    small wasop fix
          SuperS    small fix for SunOS
bleah     PPSlim    Fixed booting with full length handles
          BarkerJr  Allow wildcard CTCP binds
          BarkerJr  CTCP replies go to the HELP queue..
proton    poptix    don't bother sending server in the uptime packets
stdarg    poptix    we weren't looking the user record back up on iterations on channels
                    in the NICK bind, causing the chance of a bad pointer reference =P
                    (stdarg gave me the idea to look =)
          poptix    Oh, look, SIGN and SPLT binds actually pass on the user record now, 
                    and allow flag bindings =P
various   guppy     the documentation for the need bind was slightly screwy
          Kirben    don't check for static tcl under cygwin
          dw        Helpfile says nodesync (invalid mode) instead of nodesynch.
          Zart      makes .whom more handlen friendly
          Noyga     Fixes/Additions to command stacking
|^Raven^| Noyga     PRIVMSGs with the same message to the same destination
                    are no longer stacked also USERHOST/USERIP are not stacked
                    using a comma 
          Sup       Added HOOK_DIE to allow tcl_die to have
                    a quit message.
          TaKeDa    small resync fix
          TaKaDa    fixed tcl_md5, it was broken on tcl8.1+
          Kirben    check whether cygwin requires -mwin32 to support
                    old versions of cygwin
          Kirben    check for bind in /usr/local/bind when using
                    cygwin
NeoN-	  dw	    a banreason wasn't used in some cases.
Noyga     Sup       Bot sent a useless TOPIC command to the server
                    when it joined a channel.
          SuperS    added QNX support
          stdarg    host-sanity-check had a type mismatch
          Kirben    some small fixes
Abraham   Noyga     the channel file is now backed up
various   strolchi  small fix for binds and unicode characters

1.6.6 (20 July 2001)
Found by  Fixed by  What...
          Paladin   a few minor doc updates
various   ITE       fixed a slight problem with how we export modules
          drummer   ignore removals are now shared properly
          drummer   got rid of remove_gunk since it was unused
[joco]    Sup       fixed a small buffer overflow in cmd_whois
          LethalWP  fixed a small getops bug
          ITE       .conf cleanups, added TCL threaded info in DEBUG

1.6.5 (10 July 2001)
Found by  Fixed by  What...
TaKeDa    Fabian    Fixed 'make config' for some disabled_modules cases.
          Tothwolf  Readded missing std_args.h check.
Sup       guppy     removed an old ircd limit hack (legacy stuff owns)
          ejm       Fixed password checks in msg commands
          poptix    ctcr had the wrong args for 'uh', maybe this will break
                    something, I doubt it.
FumBa     guppy     wire.mod now checks if an encryption module is loaded
          poptix    guppy broke chattr's isowner() check
          dw        bot op status was not shown in .channel
          Tothwolf  Simplified and cleaned up variable usage and several
                    tests in configure.
          Tothwolf  Fixed broken pthreads checking.
KuNgFo0   Sup       Showing `inactive' in .status when the bot is not on the
                    channel was a bit confusing. Also added #eggfaq@EFNet to
                    docs.
Abraham   guppy     added: tcl_haschanrec
various   Sup       Prevent -b/-e/-I flooding by using random delays.
          guppy     misc cleanups in while() loops
          guppy     updated getops.tcl to v2.3
          guppy     updated recommended tcl version to 8.3.3 and changed the
                    ftp site for tcl to ftp.eggheads.org since
                    ftp.scriptics.com can be fairly picky these days.
          guppy     don't try to use null pointers in tbuf code *duh*
SegFault  guppy     small fix to what nickname we can use when we type "new"
          zip       we should use errno to detect EAGAIN in net.c
          guppy     display the proper queue that is full instead of just
                    DP_MODE
BenDover  guppy     changed the wording of %bantime <XdXhXm>
          Kirben    mount the eggdrop directory as binary in cygwin
          Kirben    compress.mod/dns.mod now check for the compiler also
          Sup       Made server-timeout match the default value in the code.
Amun      Sup       Added few missing brackets to channels.mod/channels.h
                    and exported remove_channel().
          Kirben/   check for pthread_mutex_init as a function instead of
          guppy     in a library
          Kirben    detect __res_mkquery since we detect __res_init now
Sup       G`Quann   Fixed empty line on LOG_SRVOUT and removed a
                    debug-output which confused users
          G`Quann   flush_inbuf and a killsock bug
          ITE       some access checking in msg commands
          guppy     tbuf fix
          guppy     check a bit harder for pthread_mutex_init
various   Oliver/   small fix to sscanf for libsafe systems
          guppy
          Sup       Made srandom() use getpid() and getppid()
          Sup       added .whoami command
          stdarg    more utf problems, buffer overflow(s)
          Kirben/   More Cygwin fixes
          RebuM
          NML_375   Fix for dccdumpfile/dumpfile
          poptix    Calling a proc from a bind, that modified the user
                    record of the person that triggered the bind, could
                    cause a crash.
          poptix    Memory leak in filesys.mod, that's been there since 1.3.x
          poptix    'setflags' never accepted all the aruements, fixed.
Tothwolf  Sup       tcl_ignorelist was showing the wrong expiration time.
poptix    poptix    Info locking was broken, and .info wasn't in .help
          Tothwolf  additions/clarifications to tcl-commands.doc
          poptix    getops.tcl problem due to ircnet hack support for
                    ! channels
          Sup       Don't try to relay to bots without proper address or
                    relay-port.
          Sup       Fixed .chaddr from changing the telnet-port and
                    relay-port.
          timothy   new evnt: loaded
          poptix    tcl command mkdir had wrong BADARGS (didnt allow channel
                    flags)
          poptix    when tcl var servers was empty, we had problems.
guppy     Sup       new bugs e-mail address: bugs@eggheads.org
          Sup       Added a setting for default console flags to
                    eggdrop.simple.conf, and made console-autosave
                    disabled by default.
Abraham   guppy     new evnt: prerestart (restart is tricky)
various   drummer/  we now detect __res_init for glibc2.2
          guppy
          guppy     removed legacy /trace support for keep-nick
          guppy     fixed a little bug that will happen in September of 2001
          TaKeDa    show the handle when rejecting a duplicate bot connection
          fuchs     small fix to MSGM's bind table
slennox   Sup       Updated the help channels in the docs.
          Eule      changed the way we check for sticky bans (saves cpu)
          Eugene    fixed various formatting mistakes
          SuperS    made the IRIX5,6 and 6-64bit OS detection into one check

1.6.4 (13 April 2001)
Found by  Fixed by  What...
          Sup       Minor fixes to write_debug() function.
          Eugene    more German translations and some typo fixes
          guppy     modified weed and autobotchk to find tclsh better
NaTaS     ITE       fixed weed's b<days> switch
          Sup       When rejecting bots don't try to execute rembot()
                    for bots that match bot's botnet-nick.
          Eugene    improved the German translations
fabulous  guppy     dcc resumes with no requested data are now ignored
                    properly
          Krome     call sync() after saving the userfile
various   Krome     fixed .-noteign from crashing the bot
          Wingman/  updated all the copyright info for 2001
          guppy
          Krome     modes-per-line works now when its set to 3
various   Darude    fixed channel add #chan from crashing the bot
          Eugene    various small typo fixes
          nakee     solaris make gcc fix
          Zart      small fix to the unicode stuff to handle Tcl > v9
guruz     Sup       Added matchbotattr to alltools.tcl.
          kirben    removed some legacy cygwin compatibility
          dw        cmd_stick activates the bans now
          Abraham   fixed a small remote-boots issue
          ITE       fixed the remote motd bug
blaster   ITE       fixed a small dns.c bug with hostname resolving
          Wingman   removed debug-tcl, since this is something noone uses
                    and is more bloat than anything
Darude    Darude/   encrypt/decrypt with highbit character messed up the
          Wingman   string
KingBob   Tothwolf/ Fixed rest of the problems with utf8 characters.
          Wingman

1.6.3 (27 February 2001)
Found by  Fixed by  What...
          guppy     made blowfish.mod a bit more friendly with other
                    encryption modules and also added hooks in the core
                    for string encryption/decryption
G`Quann   symband   Fixed a memleak within the XTRA field.
          Habeeb    if my-ip is wrong, tell the user that as the error msg
          slennox   updated sentinel to v2.50
          Jason     actually remove a ban from irc when a sharebot removes it
          Tothwolf  do not allow eggdrop to run as root
darkfall  Sup       msg_hello() was unable to add users with long nicks.
                    Also slightly cleaned up irc.mod/msgcmds.c.
          Jason     Fixed misformed notices in notes module. Corrected use
                    of language file, and fixed lang file entry.
          Tothwolf  shutdown once getting a SIGTERM by default
          Tothwolf  Improved Tcl version reporting
habeeb    Sup       Updated the help channels in README.
PPSlim    PPSlim/   +revengebot no longer requires that the bot has a
          guppy/    user-record for itself.
          Fabian
project10 guppy     made the reserved-port setting into reserved-portrange
various   Tothwolf  added i18n support to fix our problems with tcl
          PPSlim    some minor doc fixes
GregMo    Sup       `.note' wasn't correctly requiring a message parameter.
          Jason     fixed it so that +d or +k users cannot remove hosts and
                    thus circumvent auto-kick or deop
GregMo    guppy     fixed cmd_binds when called with no argument
          guppy     cleaned up Context and Assert usage in the modules

1.6.2 (January 14, 2001)
Found by  Fixed by  What...
S Wilcox  Sup       Fixed a minor typo in got432().
          blaster   fixed cmd_binds when doing '.binds all'
various   guppy     cmd_chaddr was broken thanks to a patch of mine
SuperS    ITE       fixed the traffic accounting code when dealing
                    high amounts of traffic
          ITE       made configure work properly when called with an
                    absolute path
Ian       Ian/      share.mod now uses .share.nick.unixtime.users as a
          guppy     temp file when recieving the userfile
          toot      fixed XTRA info from not working
          toot      fixed my bug that made revenge-mode get set back to
                    1 all the time.
          TaKeDa    we now understand negative limits (IRCnet allows this)
TaKeDa    Fabian    Parameter missing for share.mod's status information and
                    a uff error message. Minor optimisations elsewhere.
          Fabian    Removed old high character hack from readtclprog, as the
                    actual problem is now fixed.
many      Wingman   Added proper support for tcl unicode changes since 8.1.
          guppy     cleaned up Context; usage in the core
          guppy     rewrote tcl_duration
          guppy     more use of strncpyz and egg_snprintf in the core
          guppy     did some cleanup in tcl[user/misc/dcc].c
          Sup       Added a channel option to .[un]stick and slightly
                    cleaned up channels.mod/cmdschan.c.
fabulous  Fabian    Two calls to fclose() were missing in transfer.mod,
                    causing eggdrop to leak file descriptors.
          Eule      hopefully fixed the cycle-flood problem on some efnet
                    servers
          Eule      autovoice now uses autoop delay also
          Tothwolf  cleaned up some language entries
          Sup       default-port was set in the wrong location.
          ITE/      added '--disable-tcl-threads' to configure
          Tothwolf

1.6.1 (November 22, 2000)
Found by  Fixed by  What...
          Wiktor    updated KNOWN-PROBLEMS
          Eule      fixed a crash dealing with expired masks and a memleak
                    in misc.c
          toot      made revenge-mode a per-channel setting, rather than
                    global.
          dw        set quiet-save was missing in the help file.
suizide   dw        Seen module returned %s instead of nick in certain replys.
          Eule      small fix for enforcebans
          dw        Do not set bans if they don't match someone in the channel
                    and the channel is set +dynamicbans.
various   Fabian    Channel masks for unsupported channels weren't properly
                    skipped when parsing the user-file.
          Bob/      Now using lines with up to 500 instead of only 480
          Fabian    characters. Not truncating message anymore if it's longer
                    than 500 characters and doesn't contain spaces.
paran0id  Fabian    Fixed crash in expired_mask() when checking ops not
                    present in the user-list.

1.6.0 (November 15, 2000)
Found by  Fixed by  What...
Paladin   guppy     MISC_NOUSERFILE includes the actual config filename now
          dw        strict-host's default did not match the config default
                    of 0
          ITE       do not force +f on masters or owners
          Eule      removed legacy code for an ircd2.9 bug
          Wiktor/   removed the remaining lagcheck leftovers
          guppy
          Eule      fixed an issue with enforcebans and exempts.
          guppy     upgraded sentinel.tcl to v2.00
          Sup       Fixed minor typo in status_log().
Wiktor    Sup       Directly linked bots can't be removed anymore.
          guppy     removed 1.3.x updates from UPDATES.pre1.5
          Wiktor    Concated the UPDATE files
          Eule      Using "JOIN 0" instead of explicitly leaving every channel.
          guppy     New script: cmd_resolve.tcl (adds a .resolve command).
|^Raven^| Fabian    DNS module failed to handle IP address 0.0.0.0 properly.
guruz/    Fabian    Detect id-channel-names used as channel names (e.g. added
Evo|ver             with .+chan) during IRC session.
          Sup       Removed left-over command `.resolve' from dns.mod/dns.c.
          Sup       Made `.[de]op' and `.[de]voice' get nick if it wasn't
                    specified and added few missing flags to `.channel'
                    output. Also slightly cleaned up irc.mod/cmdsirc.c.
ReBEL     guppy     Increased the length of ban reasons from 65 to 160 (I
                    think this is what RFC1459 allows for default).
          Fabian    Moved strncpyz() macro from server.mod to a global location.
TaKeDa    Eule      Restricted WHO stacking to add up to a maximum of MAXPENALTY
                    penalty seconds.
          Eule      Added channel specific aop-delay setting. Allows randomly
                    delayed auto-ops, auto-ops after a certain delay and the
                    current behaviour, i.e. immediate auto-op.
Eule      Fabian    Fixed IRC_DO_CHANNEL_PART call from channels.c.
Abraham   Fabian    Fixed compiler warnings about 'const' for tcl libraries
                    that don't declare Tcl_SetVar as taking const strings.
          drummer   Fixed overflow in proxy_connect() for sun_firewall.
Tothwolf  Fabian    Could not remove joining channel from procs called by
                    JOIN bind.
fabulous  Fabian    The filesys module did not support remotely linked files.
                    Instead, the bot crashed in various places and didn't
                    even attempt to save/load the link information.
          Eule      Removed duplicate servlimit check from irc.mod.
          Eule      Added `e' as global- and channel-flag for users exempted
                    from the stopnethack checks.
          Fabian    Minor cleanup of protocol in back-ground code.
          Fabian    Avoid data lossage during the start of connections, while
                    the receiving dcc functions aren't listening yet. So now
                    you can blindly start sending data right after connecting
                    and depend on the OS and eggdrop to do The Right Thing.
Abraham,  Fabian    Changed failure of socket() to non-fatal event.
TaKeDa
TheUnknown Fabian   Fixed support for SunOS / Solaris.
          Fabian    Don't actually delete the bind structures immediately,
                    use centralised garbage collector instead. Cleaned up
                    various aspects of the bind list handling.
Sup       Fabian    Don't insist on proper domainname during hostname
                    detection.
Sup       Fabian    Properly call PART bind when removing channel and the bot
                    will therefore leave the channel shortly. Also slightly
                    reworked channel removal.
          Fabian    Move actual assert check back into macro, saving a
                    function call.
NigtHuntr Fabian    Removed small compile warning about ambigious if/else.
Abraham   Eule      Fixed and optimised ban/exempt and invite expiration code
                    for global and channel specific masks.
zart      Sup       DCC send and chat requests send to channels are now
                    ignored.
          Looser^   Fixed typo in irc.mod/irc.h me_op export macro.
          Eule      Made the bot recognise modes during CHAN_PEND. Allows us to
                    properly recognise bans/other masks and call mode binds.
          Eule      Fixed get_user_by_host, which was broken for strict_host
                    set to 0.
          Eule      Slightly optimised gotnick() by replacing the call to
                    clear_chanlist() with a specialised loop.
labtec    guppy     Instead of telnet!*@* we now use -telnet!*@* since no valid
                    IRC nicknames can be prefixed with a dash (per RFC1459).
          Eule      Added proper logics to the user{bans,exempts,invites}
                    settings and removed the clearbansset setting.
Abraham/  Fabian    Small typo in ismember() (added during cleanup) caused
DennisMV            channel functions to freak out. Sigh.
          Cybah     flush_mode() cleanups. -{b,e,I} now sent before +{b,e,I}.
                    used egg_strcatn to make buffer-overflow free.
          Fabian    Fixed caching for Tcl configuration details. As soon as
                    different libraries are detected, we discard cached
                    values.
          SuperS    Cleaned up style for aclocal.m4 system handling. Added
                    support for SunOS4.
          Fabian    Caching -pipe test results for configure.
various  TheUnknown Fixed linking for Sparc with SunOS/BSD/Linux, which caused
                    the bot to crash under certain circumstances.
         TheUnknown Added use of the -pipe compiler option, to speed-up
                    compilation.
          Eugene    Fixed bugs in German translation, typo in doc/MODULES and
                    lines longer than 80 characters in a few places.
          Fabian    Generic cleanups.
MsingLnk  Fabian    Fixed format-type bugs in notes.mod crashing the bot.
various   Fabian    Added support for threaded Tcl libs by implementing the
                    early-fork hack. Cleaner support will be possible in 1.7.
Wiktor    Fabian    Disabled cycling for +a !channels. Minor cleanups.
          Fabian    Minor optimizations in irc.mod:chan.c.
          Eule      Checking for m->user == NULL in kick_all() and
                    refresh_ban_kick() now. Minor optimizations.
          guppy     Removed `SERVER SUPPORT LOADED' message.
Igmar     Fabian    Added missing checks around new_dcc() call. This prevents
                    the bot from crashing under high connection load.
          Cybah     Added egg_strcatn function.
          Eugene    Repositioned help-path setting in eggdrop.simple.conf so
                    that the modules actually load the help files.
FuzzBuster Fabian   Minor documentation fix to seen.mod help.
Karsten   Fabian    transfer.mod allowed memory DoS for turbo-dcc.
Johnny-   Fabian    Minor correction to the list of used flags in flag.h.
Mnemonic
          guppy     Added language support to assoc.mod, console.mod and
                    notes.mod. Cosmetic fix to "module loaded" message.
          guppy     Removed some unneeded language macros.
          guppy     Cleaned up ctcp.mod. Reordered some of the ctcp_mode
                    checks.
          guppy     Added the [pass] argument in the .jump help reference.
Ben       Fabian    Added IPv6-masks support (bans/exempts/invites/ignores).
Abraham   Fabian    Fixed minor, newly introduced mess-up in `.chaninfo'
                    output.
Abraham/  Fabian    User defined flags weren't displayed correctly for
Kelvin              inactive channels, which the bot hadn't joined to yet.
Joker     Fabian    Fixed further places where +/-revengebot was not properly
                    integrated or documented.
          Fabian    Fixed eggdrop test-run for vpath. Using autoconf macros
                    for caching in aclocal.m4. Changed -L. to -L`pwd` for
                    libtcls < 7.4 support hack.
          Fabian    Added strftime compatibility function.
          Eule      Re-added bell character to note message. This can be
                    filtered out with the `.strip +g' command.
          Koach     We now send PASS before sending NICK or USER.
          guppy/    made share.mod unlink its temp userfile.
          Fabian
guppy     Fabian    Fixed a few format string bugs. Cleaned up style.
Wiktor    Fabian    Fixed crash when a received user file failed to load.
Wiktor    Fabian    compress module didn't indicate errors correctly.
          Fabian    Unified generic int types. Replaced my_?to?l() with
                    ?to?l(). Replaced obsolete macros. Various cleanups.
          Fabian    Made sure only <module>_start function symbols were
                    exported by modules. Fixed channels, console, dns, irc,
                    notes and transfer modules. Removed unneeded data in
                    non-debug mode from dns module compile.
          Eule      Fixed memory leak in channel key handling. Optimized use
                    of recheck_channel and recheck_channel_modes.
ridens    Fabian/   fixed `.whois'/`.match' crash for users without laston
          SuperS    data, caused by strftime changes.
          Fabian    finish_share() cleanups and optimizations.
          SuperS    Fixed configure problems on 64bit IRIX.
SuperS    Fabian    Removed connect_server() call in nuke_server() to avoid
                    uncontrolled recursion.
          Fabian    Cleaned up resolve_success and resolve_failure DNS hooks.
          Eule      Fixed various aspects of exempt handling.
toot      Sup       add_bot_hostmask now adds static hostmasks for bots.
          Fabian    Minor cleanups and optimizations in the irc module.
          Eule      Included +l and +k modes in modesperline-calculation.
                    Added `include-lk' setting to control this.
          SuperS    Fixed compatibility issues on IRIX. Added SINIX to
                    configure. Removed unneeded header std_args.h.
          FirebaII  Fixed filesys module to use NICKMAX instead of HANDLEN in
                    one place.
          Fabian    Minor fixups in filesys module.
          G`Quann   Removed lagcheck feature because it caused too many
                    problems.
Kool Cat  Fabian    Added meaningful error message for disabled tcl_dccsimul.
dirtymac  Fabian    Lowered retry timeout for failed DNS requests to 10
                    minutes.
          Eule      Fixed possible memleaks related to chan->channel.key,
                    chan->cmode[] and chan->key.
various   Fabian    Under certain circumstances, the old user file was
                    deleted and the new user file wasn't correctly created.
          blaster   Fixed crash in splitc().
          Tothwolf  Removed checks for bogus masks in +ban, +exempt, and
                    +invite. Minor error message fixes. Minor source cleanups.
          Cybah     Added splitcn() to limit how many bytes get copied to
                    first.
                    Shrunk buffer size in cmd_boot(), using the new function.
          Shaun     Fixed crash with handles larger than 19 characters.
