# Makefile for src/mod/
# $Id: Makefile.in,v 1.6 2000/03/05 23:22:48 fabian Exp $

SHELL = /bin/sh
top_srcdir = @top_srcdir@

@SET_MAKE@
INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA = @INSTALL_DATA@
INSTALL_SCRIPT = @INSTALL_SCRIPT@

# Note: The following three lines are automatically adjusted by
#       misc/modconfig. They have to be present here.
mods =
mod_objs =
mod_libs =

modconfig = $(top_srcdir)/misc/modconfig --top_srcdir=$(top_srcdir)

MAKE_MOD = $(MAKE) 'MAKE=$(MAKE)' 'CC=$(CC)' 'LD=$(LD)' \
'STRIP=$(STRIP)' 'CFLAGS=$(CFLAGS)' 'CPPFLAGS=$(CPPFLAGS)'

doofus:
	@echo ""
	@echo "Let's try this from the right directory..."
	@echo ""
	@cd $(top_srcdir); $(MAKE)

modules: $(mod_libs)
	@echo "All modules compiled."
	@echo ""

static: $(mod_objs)
	@$(modconfig) static.h

.SUFFIXES:
.SUFFIXES: .mod .mod_so .mod_o

.mod.mod_so:
	@cd $*.mod; $(MAKE_MOD) modules;

.mod.mod_o:
	@cd $*.mod; $(MAKE_MOD) static;

depend:
	@for i in $(mods); do cd $$i; $(MAKE_MOD) depend; cd ../; done

config:
	@for i in $(mods); do \
		if test -f $$i/configure; then \
			modname=`echo $$i | sed -e 's/.mod//'`; \
			echo ""; \
			echo "Configuring module $${modname} ..."; \
			echo ""; \
			(cd $$i && ./configure --cache-file=../$(top_srcdir)/config.cache --srcdir=../$(top_srcdir)/src/mod/$$i); \
		fi; \
	done; \
	echo ""

clean:
	@rm -f *.o *.so *~ static.h mod.xlibs
	@for i in *.mod; do cd $$i; $(MAKE) 'MAKE=$(MAKE)' clean; cd ../; done

distclean:
	@rm -f *.o *.so *~ static.h mod.xlibs
	@for i in *.mod; do \
		cd $$i; $(MAKE) 'MAKE=$(MAKE)' distclean; cd ../; \
	done

install: install-help install-language

install-help:
	@echo "Copying module help files."
	@if test ! -d $(DEST)/help; then \
		echo "Creating 'help' subdirectory."; \
		$(top_srcdir)/misc/mkinstalldirs $(DEST)/help; \
	fi; \
	for i in $(mods); do \
		if test ! "x`echo $$i/help/*.help`" = "x$$i/help/*.help"; then \
			for h in $$i/help/*.help; do \
				$(INSTALL_DATA) $$h $(DEST)/help/; \
			done; \
		fi; \
	done;
	@if test ! -d $(DEST)/help/msg; then \
		echo "Creating 'help/msg' subdirectory."; \
		$(top_srcdir)/misc/mkinstalldirs $(DEST)/help/msg; \
	fi; \
	for i in $(mods); do \
		if test ! "x`echo $$i/help/msg/*.help`" = "x$$i/help/msg/*.help"; then \
			for h in $$i/help/msg/*.help; do \
				$(INSTALL_DATA) $$h $(DEST)/help/msg/; \
			done; \
		fi; \
	done;
	@if test ! -d $(DEST)/help/set; then \
		echo "Creating 'help/set' subdirectory."; \
		$(top_srcdir)/misc/mkinstalldirs $(DEST)/help/set; \
	fi; \
	for i in $(mods); do \
		if test ! "x`echo $$i/help/set/*.help`" = "x$$i/help/set/*.help"; then \
			for h in $$i/help/set/*.help; do \
				$(INSTALL_DATA) $$h $(DEST)/help/set/; \
			done; \
		fi; \
	done;

install-language:
	@echo "Copying module language files."
	@if test ! -d $(DEST)/language; then \
		echo "Creating 'language' subdirectory."; \
		$(top_srcdir)/misc/mkinstalldirs $(DEST)/language; \
	fi; \
	for i in $(mods); do \
		if test ! "x`echo $$i/language/*.lang`" = "x$$i/language/*.lang"; then \
			for h in $$i/language/*.lang; do \
				$(INSTALL_DATA) $$h $(DEST)/language/; \
			done; \
		fi; \
	done;

#safety hash
